<!DOCTYPE html>
<html lang="en">
<head>
<script type='text/javascript' src='//pl27861179.effectivegatecpm.com/f8/4c/17/f84c172a799943166764ce7874ea940f.js'></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ConnectNexus - WhatsApp Groups</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Add Cropper.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <style>
        /* Disable text selection and zoom */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        :root {
            --primary: #6C63FF;
            --primary-light: #8A85FF;
            --secondary: #FF6584;
            --dark: #1A1A2E;
            --dark-light: #2A2A3E;
            --light: #F8F9FA;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
            --verified: #0095F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: pan-y;
        }

        /* Splash Screen */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        .splash-logo {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .half-moon-loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(108, 99, 255, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .splash-text {
            color: var(--light);
            font-size: 1rem;
        }

        /* Header */
        .header {
            background: var(--dark-light);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 999;
            border-bottom: 1px solid rgba(108, 99, 255, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
            text-decoration: none;
        }

        .header-search {
            flex: 1;
            margin: 0 1rem;
            position: relative;
        }

        .header-search input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border-radius: 20px;
            border: 2px solid var(--dark);
            background: var(--dark);
            color: var(--light);
            font-size: 0.9rem;
        }

        .header-search i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            position: relative;
        }

        .btn-icon {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.2rem;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.3s;
            position: relative;
        }

        .btn-icon:active {
            background: rgba(108, 99, 255, 0.2);
        }

        .notification-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--error);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 1rem;
            padding-bottom: 90px;
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }

        .main-content.loaded {
            opacity: 1;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .section-title {
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
            color: var(--light);
        }

        /* Horizontal Groups Layout */
        .groups-horizontal {
            display: flex;
            overflow-x: auto;
            gap: 1rem;
            padding: 0.5rem 0;
            margin: 0 -1rem;
            padding-left: 1rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .groups-horizontal::-webkit-scrollbar {
            display: none;
        }

        .group-card-horizontal {
            min-width: 280px;
            background: var(--dark-light);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(108, 99, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .group-card-horizontal:active {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .group-image {
            width: 100%;
            height: 160px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--dark), var(--dark-light));
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .group-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .group-card-horizontal:hover .group-image img {
            transform: scale(1.05);
        }

        .group-image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .group-members {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .group-featured {
            background: rgba(255, 193, 7, 0.9);
            color: var(--dark);
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }

        .group-content {
            padding: 1rem;
        }

        .group-category {
            display: inline-block;
            background: rgba(108, 99, 255, 0.2);
            color: var(--primary-light);
            padding: 0.2rem 0.8rem;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-bottom: 0.5rem;
        }

        .group-title {
            font-size: 1rem;
            margin-bottom: 0.3rem;
            color: var(--light);
            font-weight: 600;
        }

        .group-description {
            color: #aaa;
            font-size: 0.8rem;
            margin-bottom: 0.8rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .group-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            font-size: 0.7rem;
            color: #888;
        }

        .group-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.8rem;
        }

        .group-poster {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .poster-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
            font-weight: 600;
            overflow: hidden;
            border: 2px solid var(--primary);
        }

        .poster-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .poster-name {
            font-size: 0.75rem;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .verified-badge {
            color: var(--verified);
            font-size: 0.8rem;
        }

        .btn {
            padding: 0.8rem 1.2rem;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 15px rgba(108, 99, 255, 0.4);
        }

        .btn-primary:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(108, 99, 255, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--light);
            border: 2px solid var(--primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-error {
            background: var(--error);
            color: white;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: var(--dark-light);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            border: 1px solid transparent;
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark-light);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.5rem 0;
            border-top: 1px solid rgba(108, 99, 255, 0.3);
            z-index: 1000;
            height: 70px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #888;
            text-decoration: none;
            font-size: 0.7rem;
            transition: color 0.3s;
            flex: 1;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
        }

        .add-button {
            position: relative;
            bottom: 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.5);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-button:active {
            transform: scale(0.95);
            box-shadow: 0 4px 15px rgba(108, 99, 255, 0.4);
        }

        .add-button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            bottom: 10px;
        }

        .add-label {
            font-size: 0.7rem;
            color: var(--primary);
            margin-top: 0.2rem;
            font-weight: 600;
        }

        /* Profile Page Styles */
        .profile-header {
            text-align: center;
            padding: 2rem 1rem;
            background: var(--dark-light);
            border-radius: 15px;
            margin-bottom: 1.5rem;
        }

        .profile-avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
        }

        .profile-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            font-weight: 600;
            overflow: hidden;
            border: 3px solid var(--primary);
            position: relative;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-edit-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--dark-light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-edit-btn:hover {
            background: var(--primary-light);
            transform: scale(1.1);
        }

        .profile-name {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .profile-email {
            color: #aaa;
            font-size: 1rem;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-item {
            background: var(--dark-light);
            padding: 1.2rem;
            border-radius: 15px;
            text-align: center;
            border-left: 4px solid var(--primary);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.3rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #aaa;
        }

        .profile-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin: 2rem 0;
        }

        .action-item {
            background: var(--dark-light);
            padding: 1.2rem;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
            color: var(--light);
            transition: background 0.3s;
        }

        .action-item:active {
            background: rgba(108, 99, 255, 0.2);
        }

        .action-icon {
            width: 40px;
            height: 40px;
            background: rgba(108, 99, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        /* Guest Profile State */
        .guest-welcome {
            text-align: center;
            padding: 3rem 2rem;
        }

        .guest-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .guest-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* Notifications Page */
        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .notification-item {
            background: var(--dark-light);
            padding: 1.2rem;
            border-radius: 15px;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .notification-icon.success {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }

        .notification-icon.warning {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }

        .notification-icon.error {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error);
        }

        .notification-icon.info {
            background: rgba(108, 99, 255, 0.2);
            color: var(--primary);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .notification-message {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .notification-time {
            color: #666;
            font-size: 0.7rem;
        }

        /* My Groups Page */
        .groups-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .group-tab {
            padding: 0.8rem 1.2rem;
            background: var(--dark-light);
            border-radius: 10px;
            font-size: 0.9rem;
            white-space: nowrap;
            border: 1px solid transparent;
            transition: all 0.3s;
        }

        .group-tab.active {
            background: rgba(108, 99, 255, 0.2);
            border-color: var(--primary);
            color: var(--primary-light);
        }

        .groups-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .my-group-card {
            background: var(--dark-light);
            border-radius: 15px;
            padding: 1.2rem;
            border-left: 4px solid var(--primary);
        }

        .my-group-card.rejected {
            border-left-color: var(--error);
        }

        .my-group-card.pending {
            border-left-color: var(--warning);
        }

        .my-group-card.approved {
            border-left-color: var(--success);
        }

        .group-status {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }

        .status-approved {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }

        .status-rejected {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error);
        }

        .group-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .group-actions .btn {
            flex: 1;
            padding: 0.6rem 1rem;
            font-size: 0.8rem;
        }

        /* Explore Page - UPDATED */
        .explore-filters {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .filter-row {
            display: flex;
            gap: 0.8rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .filter-row::-webkit-scrollbar {
            display: none;
        }

        .category-chip {
            padding: 0.7rem 1.2rem;
            background: var(--dark-light);
            border-radius: 25px;
            font-size: 0.85rem;
            white-space: nowrap;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            color: #aaa;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .category-chip:hover {
            background: rgba(108, 99, 255, 0.1);
            border-color: rgba(108, 99, 255, 0.3);
            color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.2);
        }

        .category-chip.active {
            background: rgba(108, 99, 255, 0.2);
            border-color: var(--primary);
            color: var(--primary-light);
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--dark-light);
            border-radius: 20px;
            padding: 1.5rem;
            width: 90%;
            max-width: 400px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid var(--primary);
            max-height: 90vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .modal-content.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--light);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid var(--dark);
            background: var(--dark);
            color: var(--light);
            font-size: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1.5rem;
        }

        .form-actions .btn {
            flex: 1;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .loading-spinner.active {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(108, 99, 255, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* NEW: Modal Loading Overlay */
        .modal-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            border-radius: 20px;
            z-index: 10;
        }

        .modal-loading.active {
            display: flex;
        }

        .modal-loading-text {
            color: var(--light);
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        /* Modern Alerts */
        .alert {
            position: fixed;
            top: 100px;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s;
            max-width: 300px;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .alert.show {
            transform: translateX(0);
        }

        .alert-success {
            background: var(--success);
            border-left: 4px solid #2E7D32;
        }

        .alert-error {
            background: var(--error);
            border-left: 4px solid #C62828;
        }

        .alert-warning {
            background: var(--warning);
            border-left: 4px solid #EF6C00;
        }

        .alert-info {
            background: var(--primary);
            border-left: 4px solid #4A43B5;
        }

        .alert-icon {
            font-size: 1.2rem;
        }

        /* Report Modal - UPDATED STYLING */
        .report-reason {
            margin-bottom: 1rem;
        }

        .report-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            background: var(--dark);
            border-radius: 10px;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .report-option:hover {
            background: rgba(108, 99, 255, 0.1);
            border-color: var(--primary);
        }

        .report-option input {
            margin-right: 0.8rem;
            transform: scale(1.2);
        }

        .report-option label {
            flex: 1;
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: #aaa;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Image Upload Area */
        .image-upload-area {
            border: 2px dashed var(--primary);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1rem;
        }

        .image-upload-area:hover {
            background: rgba(108, 99, 255, 0.1);
        }

        .image-upload-area i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .image-upload-text {
            color: var(--light);
            font-size: 0.9rem;
        }

        /* Image Preview */
        .image-preview {
            width: 100%;
            border-radius: 10px;
            object-fit: cover;
            margin: 0.5rem 0;
            display: block;
        }

        /* Profile Image Preview */
        .profile-image-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 15px auto;
            display: block;
            border: 3px solid var(--primary);
        }

        /* Image Crop Modal */
        .image-crop-container {
            width: 100%;
            max-height: 400px;
            margin-bottom: 1rem;
        }

        .crop-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            gap: 10px;
        }

        .crop-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .crop-rotate {
            background: var(--primary);
            color: white;
        }

        .crop-reset {
            background: var(--secondary);
            color: white;
        }

        .crop-zoom {
            background: var(--dark);
            color: var(--light);
            border: 1px solid var(--primary);
        }

        /* NEW: Skeleton Loading Styles */
        .skeleton {
            background: linear-gradient(90deg, var(--dark-light) 25%, rgba(108, 99, 255, 0.1) 50%, var(--dark-light) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        .skeleton-group-card {
            min-width: 280px;
            background: var(--dark-light);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(108, 99, 255, 0.2);
        }

        .skeleton-group-image {
            width: 100%;
            height: 160px;
            background: var(--dark);
        }

        .skeleton-group-content {
            padding: 1rem;
        }

        .skeleton-category {
            width: 80px;
            height: 20px;
            margin-bottom: 0.5rem;
        }

        .skeleton-title {
            width: 100%;
            height: 20px;
            margin-bottom: 0.5rem;
        }

        .skeleton-description {
            width: 100%;
            height: 40px;
            margin-bottom: 0.8rem;
        }

        .skeleton-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skeleton-poster {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .skeleton-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .skeleton-name {
            width: 80px;
            height: 12px;
        }

        .skeleton-button {
            width: 70px;
            height: 35px;
            border-radius: 20px;
        }

        .skeleton-profile-header {
            text-align: center;
            padding: 2rem 1rem;
            background: var(--dark-light);
            border-radius: 15px;
            margin-bottom: 1.5rem;
        }

        .skeleton-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1rem;
        }

        .skeleton-name-large {
            width: 150px;
            height: 24px;
            margin: 0 auto 0.5rem;
        }

        .skeleton-email {
            width: 120px;
            height: 16px;
            margin: 0 auto;
        }

        .skeleton-stat-item {
            background: var(--dark-light);
            padding: 1.2rem;
            border-radius: 15px;
            text-align: center;
        }

        .skeleton-stat-number {
            width: 40px;
            height: 24px;
            margin: 0 auto 0.3rem;
        }

        .skeleton-stat-label {
            width: 60px;
            height: 12px;
            margin: 0 auto;
        }

        .skeleton-action-item {
            background: var(--dark-light);
            padding: 1.2rem;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .skeleton-action-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
        }

        .skeleton-action-text {
            flex: 1;
        }

        .skeleton-action-title {
            width: 120px;
            height: 16px;
            margin-bottom: 0.3rem;
        }

        .skeleton-action-subtitle {
            width: 80px;
            height: 12px;
        }

        .skeleton-notification {
            background: var(--dark-light);
            padding: 1.2rem;
            border-radius: 15px;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .skeleton-notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .skeleton-notification-content {
            flex: 1;
        }

        .skeleton-notification-title {
            width: 70%;
            height: 16px;
            margin-bottom: 0.5rem;
        }

        .skeleton-notification-message {
            width: 90%;
            height: 14px;
            margin-bottom: 0.5rem;
        }

        .skeleton-notification-time {
            width: 50%;
            height: 12px;
        }

        /* Hide on desktop */
        @media (min-width: 768px) {
            body::before {
                content: "This app is designed for mobile devices only. Please view on a mobile device.";
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100vh;
                background: var(--dark);
                color: var(--light);
                font-size: 1.2rem;
                text-align: center;
                padding: 2rem;
            }
            body > * {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-logo">
            <i class="fas fa-comments"></i>
        </div>
        <div class="half-moon-loader"></div>
        <div class="splash-text">ConnectNexus</div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo" id="homeLogo">
                <i class="fas fa-comments"></i>
                <span>ConnectNexus</span>
            </div>
            <div class="header-search" id="headerSearch">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search groups...">
            </div>
            <div class="header-actions">
                <button class="btn-icon" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                    <div class="notification-badge" id="notificationBadge">0</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content - Home Page -->
    <div class="main-content" id="mainContent">
        <!-- Home Page -->
        <div class="page active" id="homePage">
            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
            </div>

            <!-- Featured Groups -->
            <h2 class="section-title">Featured Groups</h2>
            <div class="groups-horizontal" id="featuredGroups">
                <!-- Groups loaded dynamically -->
            </div>

            <!-- Popular Groups -->
            <h2 class="section-title">Popular Now</h2>
            <div class="groups-horizontal" id="popularGroups">
                <!-- Groups loaded dynamically -->
            </div>

            <!-- Why Choose Us -->
            <h2 class="section-title">Why Choose ConnectNexus</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Verified Groups</h3>
                    <p style="color: #aaa; font-size: 0.9rem;">All groups are verified and moderated for safety</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <h3>Wide Categories</h3>
                    <p style="color: #aaa; font-size: 0.9rem;">Find groups for every interest and community</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h3>Easy to Use</h3>
                    <p style="color: #aaa; font-size: 0.9rem;">Simple interface to discover and join groups</p>
                </div>
            </div>
        </div>

        <!-- Explore Page -->
        <div class="page" id="explorePage">
            <div class="explore-filters">
                <div class="filter-row">
                    <!-- UPDATED: Removed "All" category and added more specific categories -->
                    <div class="category-chip active" data-filter="technology">Technology</div>
                    <div class="category-chip" data-filter="business">Business</div>
                    <div class="category-chip" data-filter="education">Education</div>
                    <div class="category-chip" data-filter="entertainment">Entertainment</div>
                </div>
                <div class="filter-row">
                    <div class="category-chip" data-filter="sports">Sports</div>
                    <div class="category-chip" data-filter="health">Health</div>
                    <div class="category-chip" data-filter="gaming">Gaming</div>
                    <div class="category-chip" data-filter="lifestyle">Lifestyle</div>
                </div>
            </div>

            <h2 class="section-title">Explore Groups</h2>
            
            <!-- Skeleton loading for explore page -->
            <div class="groups-grid" id="exploreGroupsSkeleton">
                <div class="skeleton-group-card">
                    <div class="skeleton-group-image skeleton"></div>
                    <div class="skeleton-group-content">
                        <div class="skeleton-category skeleton"></div>
                        <div class="skeleton-title skeleton"></div>
                        <div class="skeleton-description skeleton"></div>
                        <div class="skeleton-footer">
                            <div class="skeleton-poster">
                                <div class="skeleton-avatar skeleton"></div>
                                <div class="skeleton-name skeleton"></div>
                            </div>
                            <div class="skeleton-button skeleton"></div>
                        </div>
                    </div>
                </div>
                <div class="skeleton-group-card">
                    <div class="skeleton-group-image skeleton"></div>
                    <div class="skeleton-group-content">
                        <div class="skeleton-category skeleton"></div>
                        <div class="skeleton-title skeleton"></div>
                        <div class="skeleton-description skeleton"></div>
                        <div class="skeleton-footer">
                            <div class="skeleton-poster">
                                <div class="skeleton-avatar skeleton"></div>
                                <div class="skeleton-name skeleton"></div>
                            </div>
                            <div class="skeleton-button skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="groups-grid" id="exploreGroups">
                <!-- Explore groups loaded dynamically -->
            </div>
        </div>

        <!-- My Groups Page -->
        <div class="page" id="myGroupsPage">
            <h2 class="section-title">My Groups</h2>
            
            <div class="groups-tabs">
                <div class="group-tab active" data-tab="all">All Groups</div>
                <div class="group-tab" data-tab="pending">Pending</div>
                <div class="group-tab" data-tab="approved">Approved</div>
                <div class="group-tab" data-tab="rejected">Rejected</div>
            </div>

            <!-- Skeleton loading for my groups -->
            <div class="groups-grid" id="myGroupsSkeleton">
                <div class="skeleton-action-item">
                    <div class="skeleton-action-icon skeleton"></div>
                    <div class="skeleton-action-text skeleton"></div>
                </div>
                <div class="skeleton-action-item">
                    <div class="skeleton-action-icon skeleton"></div>
                    <div class="skeleton-action-text skeleton"></div>
                </div>
                <div class="skeleton-action-item">
                    <div class="skeleton-action-icon skeleton"></div>
                    <div class="skeleton-action-text skeleton"></div>
                </div>
            </div>

            <div class="groups-grid" id="myGroupsList">
                <!-- My groups loaded dynamically -->
            </div>
        </div>

        <!-- Profile Page -->
        <div class="page" id="profilePage">
            <!-- Skeleton loading for profile -->
            <div id="profileSkeleton">
                <div class="skeleton-profile-header">
                    <div class="skeleton-avatar-large skeleton"></div>
                    <div class="skeleton-name-large skeleton"></div>
                    <div class="skeleton-email skeleton"></div>
                </div>
                
                <div class="profile-stats">
                    <div class="skeleton-stat-item">
                        <div class="skeleton-stat-number skeleton"></div>
                        <div class="skeleton-stat-label skeleton"></div>
                    </div>
                    <div class="skeleton-stat-item">
                        <div class="skeleton-stat-number skeleton"></div>
                        <div class="skeleton-stat-label skeleton"></div>
                    </div>
                    <div class="skeleton-stat-item">
                        <div class="skeleton-stat-number skeleton"></div>
                        <div class="skeleton-stat-label skeleton"></div>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <div class="skeleton-action-item">
                        <div class="skeleton-action-icon skeleton"></div>
                        <div class="skeleton-action-text">
                            <div class="skeleton-action-title skeleton"></div>
                            <div class="skeleton-action-subtitle skeleton"></div>
                        </div>
                    </div>
                    <div class="skeleton-action-item">
                        <div class="skeleton-action-icon skeleton"></div>
                        <div class="skeleton-action-text">
                            <div class="skeleton-action-title skeleton"></div>
                            <div class="skeleton-action-subtitle skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-header" id="profileHeader">
                <!-- Profile content loaded dynamically -->
            </div>
            
            <div class="profile-stats" id="profileStats">
                <!-- Stats loaded dynamically -->
            </div>

            <div class="profile-actions" id="profileActions">
                <!-- Actions loaded dynamically -->
            </div>
        </div>

        <!-- Notifications Page -->
        <div class="page" id="notificationsPage">
            <h2 class="section-title">Notifications</h2>
            
            <!-- Skeleton loading for notifications -->
            <div class="notifications-list" id="notificationsSkeleton">
                <div class="skeleton-notification">
                    <div class="skeleton-notification-icon skeleton"></div>
                    <div class="skeleton-notification-content">
                        <div class="skeleton-notification-title skeleton"></div>
                        <div class="skeleton-notification-message skeleton"></div>
                        <div class="skeleton-notification-time skeleton"></div>
                    </div>
                </div>
                <div class="skeleton-notification">
                    <div class="skeleton-notification-icon skeleton"></div>
                    <div class="skeleton-notification-content">
                        <div class="skeleton-notification-title skeleton"></div>
                        <div class="skeleton-notification-message skeleton"></div>
                        <div class="skeleton-notification-time skeleton"></div>
                    </div>
                </div>
            </div>

            <div class="notifications-list" id="notificationsList">
                <!-- Notifications loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" data-page="homePage">
            <i class="fas fa-home nav-icon"></i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item" data-page="explorePage">
            <i class="fas fa-compass nav-icon"></i>
            <span>Explore</span>
        </a>
        <div class="add-button-container">
            <button class="add-button" id="addGroupBtn">
                <i class="fas fa-plus"></i>
            </button>
            <div class="add-label">Add</div>
        </div>
        <a href="#" class="nav-item" data-page="myGroupsPage">
            <i class="fas fa-users nav-icon"></i>
            <span>My Groups</span>
        </a>
        <a href="#" class="nav-item" data-page="profilePage">
            <i class="fas fa-user nav-icon"></i>
            <span>Profile</span>
        </a>
    </div>

    <!-- Add Group Modal -->
    <div class="modal" id="addGroupModal">
        <div class="modal-content">
            <div class="modal-loading" id="addGroupModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Submitting Group...</div>
            </div>
            <div class="modal-header">
                <h2>Add New Group</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="groupForm">
                <div class="form-group">
                    <label for="groupImage">Group Image</label>
                    <div class="image-upload-area" id="groupImageUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="image-upload-text">Click to upload image</div>
                    </div>
                    <input type="file" id="groupImage" accept="image/*" style="display: none;">
                    <div id="groupImagePreview" class="image-preview" style="display: none;"></div>
                </div>
                <div class="form-group">
                    <label for="groupName">Group Name</label>
                    <input type="text" id="groupName" placeholder="Enter group name" required>
                </div>
                <div class="form-group">
                    <label for="groupDescription">Description</label>
                    <textarea id="groupDescription" placeholder="Describe your group" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="groupCategory">Category</label>
                    <select id="groupCategory" required>
                        <option value="">Select Category</option>
                        <option value="technology">Technology</option>
                        <option value="business">Business</option>
                        <option value="education">Education</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="sports">Sports</option>
                        <option value="health">Health</option>
                        <option value="gaming">Gaming</option>
                        <option value="lifestyle">Lifestyle</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="groupMembers">Total Members</label>
                    <input type="number" id="groupMembers" placeholder="Number of members" required>
                </div>
                <div class="form-group">
                    <label for="groupLink">WhatsApp Group Link</label>
                    <input type="url" id="groupLink" placeholder="https://chat.whatsapp.com/..." required>
                </div>
                <button type="submit" class="btn btn-primary">Submit Group</button>
            </form>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div class="modal" id="signInModal">
        <div class="modal-content">
            <div class="modal-loading" id="signInModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Signing In...</div>
            </div>
            <div class="modal-header">
                <h2>Welcome Back</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="signInForm">
                <div class="form-group">
                    <label for="signInEmail">Email</label>
                    <input type="email" id="signInEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="signInPassword">Password</label>
                    <input type="password" id="signInPassword" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
            </form>
            <p style="text-align: center; margin-top: 1rem; color: #aaa;">
                Don't have an account? <a href="#" style="color: var(--primary);" id="showSignUpLink">Create one</a>
            </p>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div class="modal" id="signUpModal">
        <div class="modal-content">
            <div class="modal-loading" id="signUpModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Creating Account...</div>
            </div>
            <div class="modal-header">
                <h2>Join ConnectNexus</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="signUpForm">
                <div class="form-group">
                    <label for="signUpName">Full Name</label>
                    <input type="text" id="signUpName" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="signUpEmail">Email</label>
                    <input type="email" id="signUpEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="signUpPassword">Password</label>
                    <input type="password" id="signUpPassword" placeholder="Create a password" required>
                </div>
                <button type="submit" class="btn btn-primary">Create Account</button>
            </form>
            <p style="text-align: center; margin-top: 1rem; color: #aaa;">
                Already have an account? <a href="#" style="color: var(--primary);" id="showSignInLink">Sign in</a>
            </p>
        </div>
    </div>

    <!-- Group View Modal -->
    <div class="modal" id="groupViewModal">
        <div class="modal-content">
            <div class="modal-loading" id="groupViewModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Loading...</div>
            </div>
            <div class="modal-header">
                <h2 id="groupViewTitle">Group Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div id="groupViewContent">
                <!-- Group details loaded dynamically -->
            </div>
            <div class="form-actions" id="groupViewActions">
                <!-- Actions loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Verification Request Modal -->
    <div class="modal" id="verificationModal">
        <div class="modal-content">
            <div class="modal-loading" id="verificationModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Submitting Request...</div>
            </div>
            <div class="modal-header">
                <h2>Request Verification</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="verificationForm">
                <div class="form-group">
                    <label for="verificationReason">Why should you be verified?</label>
                    <textarea id="verificationReason" placeholder="Explain why you deserve a verification badge..." rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="verificationProof">Proof of Identity (Optional)</label>
                    <input type="file" id="verificationProof" accept="image/*,.pdf">
                </div>
                <button type="submit" class="btn btn-primary">Submit Request</button>
            </form>
        </div>
    </div>

    <!-- Report Group Modal - UPDATED STYLING -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-loading" id="reportModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Submitting Report...</div>
            </div>
            <div class="modal-header">
                <h2>Report Group</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="reportForm">
                <div class="form-group">
                    <label style="margin-bottom: 1rem; font-weight: 600; color: var(--light);">Reason for reporting</label>
                    <div class="report-reason">
                        <div class="report-option">
                            <input type="radio" id="spam" name="reason" value="spam">
                            <label for="spam">Spam or misleading content</label>
                        </div>
                        <div class="report-option">
                            <input type="radio" id="inappropriate" name="reason" value="inappropriate">
                            <label for="inappropriate">Inappropriate content</label>
                        </div>
                        <div class="report-option">
                            <input type="radio" id="inactive" name="reason" value="inactive">
                            <label for="inactive">Inactive group</label>
                        </div>
                        <div class="report-option">
                            <input type="radio" id="other" name="reason" value="other">
                            <label for="other">Other</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reportDescription">Additional details</label>
                    <textarea id="reportDescription" placeholder="Provide more details about your report..." rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-error">Submit Report</button>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-loading" id="editProfileModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Updating Profile...</div>
            </div>
            <div class="modal-header">
                <h2>Edit Profile</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editProfileForm" novalidate>
                <div class="form-group">
                    <label>Profile Picture</label>
                    <div id="profileImagePreviewContainer" style="text-align: center;">
                        <img id="profileImagePreview" class="profile-image-preview" style="display: none;">
                    </div>
                    <div class="image-upload-area" id="profileImageUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="image-upload-text">Click to upload</div>
                    </div>
                    <input type="file" id="editProfileImage" accept="image/*" style="display: none;">
                </div>
                <div class="form-group">
                    <label for="editProfileName">Full Name</label>
                    <input type="text" id="editProfileName" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="editProfileEmail">Email</label>
                    <input type="email" id="editProfileEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="editProfileBio">Bio</label>
                    <textarea id="editProfileBio" placeholder="Tell us about yourself" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAllModals()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Profile</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Crop Modal -->
    <div class="modal" id="imageCropModal">
        <div class="modal-content">
            <div class="modal-loading" id="imageCropModalLoading">
                <div class="half-moon-loader"></div>
                <div class="modal-loading-text">Processing Image...</div>
            </div>
            <div class="modal-header">
                <h2>Crop Image</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="image-crop-container">
                <img id="cropImage" style="max-width: 100%; display: block;">
            </div>
            <div class="crop-controls">
                <button class="crop-btn crop-zoom" id="cropZoomOutBtn"><i class="fas fa-search-minus"></i></button>
                <button class="crop-btn crop-reset" id="cropResetBtn"><i class="fas fa-undo"></i></button>
                <button class="crop-btn crop-rotate" id="cropRotateBtn"><i class="fas fa-sync-alt"></i></button>
                <button class="crop-btn crop-zoom" id="cropZoomInBtn"><i class="fas fa-search-plus"></i></button>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelCropBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmCropBtn">Apply Crop</button>
            </div>
        </div>
    </div>

    <!-- Modern Alert -->
    <div class="alert" id="alert"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    <!-- Add Cropper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
    apiKey: "AIzaSyBnpvqipkjZf5PpmvtLXbVzKEWL5FYadVM",
    authDomain: "connectnexus-a9acf.firebaseapp.com",
    databaseURL: "https://connectnexus-a9acf-default-rtdb.firebaseio.com",
    projectId: "connectnexus-a9acf",
    storageBucket: "connectnexus-a9acf.firebasestorage.app",
    messagingSenderId: "903693576297",
    appId: "1:903693576297:web:5d40ad8048f211db449af8"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const storage = firebase.storage();

        // Global variables
        let currentUser = null;
        let groups = [];
        let userGroups = [];
        let notifications = [];
        let selectedCategory = 'technology'; // UPDATED: Default to first category
        let selectedFilter = 'all';
        let selectedSort = 'popular';
        let reportedGroups = [];
        let groupImageBase64 = null;
        let userProfilesCache = {};
        
        // Profile system variables
        let profileImageBase64 = null;
        let cropper = null;
        let currentImageType = null;
        let currentImageInput = null;
        
        // NEW: Real-time update interval
        let realTimeInterval = null;
        // NEW: Loading states
        let isLoadingGroups = true;
        let isLoadingUserGroups = true;
        let isLoadingProfile = true;
        let isLoadingNotifications = true;

        // DOM Elements
        const splashScreen = document.getElementById('splashScreen');
        const mainContent = document.getElementById('mainContent');
        const homePage = document.getElementById('homePage');
        const explorePage = document.getElementById('explorePage');
        const myGroupsPage = document.getElementById('myGroupsPage');
        const profilePage = document.getElementById('profilePage');
        const notificationsPage = document.getElementById('notificationsPage');
        const featuredGroups = document.getElementById('featuredGroups');
        const popularGroups = document.getElementById('popularGroups');
        const exploreGroups = document.getElementById('exploreGroups');
        const myGroupsList = document.getElementById('myGroupsList');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const addGroupModal = document.getElementById('addGroupModal');
        const signInModal = document.getElementById('signInModal');
        const signUpModal = document.getElementById('signUpModal');
        const groupViewModal = document.getElementById('groupViewModal');
        const verificationModal = document.getElementById('verificationModal');
        const reportModal = document.getElementById('reportModal');
        const addGroupBtn = document.getElementById('addGroupBtn');
        const notificationsBtn = document.getElementById('notificationsBtn');
        const notificationBadge = document.getElementById('notificationBadge');
        const closeModals = document.querySelectorAll('.close-modal');
        const groupForm = document.getElementById('groupForm');
        const signInForm = document.getElementById('signInForm');
        const signUpForm = document.getElementById('signUpForm');
        const verificationForm = document.getElementById('verificationForm');
        const reportForm = document.getElementById('reportForm');
        const searchInput = document.getElementById('searchInput');
        const alert = document.getElementById('alert');
        const navItems = document.querySelectorAll('.nav-item');
        const profileHeader = document.getElementById('profileHeader');
        const profileStats = document.getElementById('profileStats');
        const profileActions = document.getElementById('profileActions');
        const notificationsList = document.getElementById('notificationsList');
        const groupTabs = document.querySelectorAll('.group-tab');
        const categoryChips = document.querySelectorAll('.category-chip');
        const filterChips = document.querySelectorAll('.filter-row .category-chip');
        const showSignUpLink = document.getElementById('showSignUpLink');
        const showSignInLink = document.getElementById('showSignInLink');
        
        // NEW: Skeleton elements
        const exploreGroupsSkeleton = document.getElementById('exploreGroupsSkeleton');
        const myGroupsSkeleton = document.getElementById('myGroupsSkeleton');
        const profileSkeleton = document.getElementById('profileSkeleton');
        const notificationsSkeleton = document.getElementById('notificationsSkeleton');
        
        // NEW: Modal loading overlays
        const addGroupModalLoading = document.getElementById('addGroupModalLoading');
        const signInModalLoading = document.getElementById('signInModalLoading');
        const signUpModalLoading = document.getElementById('signUpModalLoading');
        const groupViewModalLoading = document.getElementById('groupViewModalLoading');
        const verificationModalLoading = document.getElementById('verificationModalLoading');
        const reportModalLoading = document.getElementById('reportModalLoading');
        const editProfileModalLoading = document.getElementById('editProfileModalLoading');
        const imageCropModalLoading = document.getElementById('imageCropModalLoading');
        
        // Image upload elements
        const groupImageUploadArea = document.getElementById('groupImageUploadArea');
        const groupImageInput = document.getElementById('groupImage');
        const groupImagePreview = document.getElementById('groupImagePreview');
        
        // Profile system elements
        const editProfileModal = document.getElementById('editProfileModal');
        const imageCropModal = document.getElementById('imageCropModal');
        const editProfileForm = document.getElementById('editProfileForm');
        const profileImageUploadArea = document.getElementById('profileImageUploadArea');
        const profileImageInput = document.getElementById('editProfileImage');
        const profileImagePreview = document.getElementById('profileImagePreview');
        const cropImage = document.getElementById('cropImage');
        const cropZoomInBtn = document.getElementById('cropZoomInBtn');
        const cropZoomOutBtn = document.getElementById('cropZoomOutBtn');
        const cropResetBtn = document.getElementById('cropResetBtn');
        const cropRotateBtn = document.getElementById('cropRotateBtn');
        const confirmCropBtn = document.getElementById('confirmCropBtn');
        const cancelCropBtn = document.getElementById('cancelCropBtn');

        // Initialize app
        function initApp() {
            showLoading();
            
            // Show skeleton loaders immediately
            showSkeletonLoaders();
            
            // Check authentication state
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        emailVerified: user.emailVerified
                    };
                    
                    // Get additional user data from database
                    db.ref('users/' + user.uid).once('value')
                        .then(snapshot => {
                            if (snapshot.exists()) {
                                const userData = snapshot.val();
                                currentUser = { ...currentUser, ...userData };
                            }
                            
                            // Load user data
                            loadUserData();
                        })
                        .catch(error => {
                            console.error("Error getting user data:", error);
                            showAlert('Error loading user data', 'error', 'fas fa-exclamation-circle');
                        });
                } else {
                    // User is signed out
                    currentUser = null;
                }
                
                // Load app data
                loadAppData();
                hideSplashScreen();
                hideLoading();
                setupEventListeners();
                setupRealtimeListeners();
                
                // NEW: Start real-time updates
                startRealTimeUpdates();
            });
        }

        // NEW: Start real-time updates every 1 second
        function startRealTimeUpdates() {
            if (realTimeInterval) {
                clearInterval(realTimeInterval);
            }
            
            realTimeInterval = setInterval(() => {
                if (currentUser) {
                    // Refresh user data
                    db.ref('users/' + currentUser.uid).once('value')
                        .then(snapshot => {
                            if (snapshot.exists()) {
                                const userData = snapshot.val();
                                currentUser = { ...currentUser, ...userData };
                                
                                // Update profile page if active
                                if (document.getElementById('profilePage').classList.contains('active')) {
                                    loadProfilePage();
                                }
                            }
                        })
                        .catch(error => {
                            console.error("Error refreshing user data:", error);
                        });
                    
                    // Refresh notifications in real-time
                    loadNotifications();
                }
            }, 1000); // Update every 1 second
        }

        // NEW: Show skeleton loaders for all pages
        function showSkeletonLoaders() {
            // Home page skeleton (already exists in your code)
            // Explore page skeleton
            exploreGroupsSkeleton.style.display = 'grid';
            exploreGroups.style.display = 'none';
            
            // My Groups page skeleton
            myGroupsSkeleton.style.display = 'grid';
            myGroupsList.style.display = 'none';
            
            // Profile page skeleton
            profileSkeleton.style.display = 'block';
            profileHeader.style.display = 'none';
            profileStats.style.display = 'none';
            profileActions.style.display = 'none';
            
            // Notifications page skeleton
            notificationsSkeleton.style.display = 'flex';
            notificationsList.style.display = 'none';
        }

        // NEW: Hide skeleton loaders when data is loaded
        function hideSkeletonLoaders() {
            // Explore page
            exploreGroupsSkeleton.style.display = 'none';
            exploreGroups.style.display = 'grid';
            
            // My Groups page
            myGroupsSkeleton.style.display = 'none';
            myGroupsList.style.display = 'grid';
            
            // Profile page
            profileSkeleton.style.display = 'none';
            profileHeader.style.display = 'block';
            profileStats.style.display = 'grid';
            profileActions.style.display = 'grid';
            
            // Notifications page
            notificationsSkeleton.style.display = 'none';
            notificationsList.style.display = 'flex';
        }

        // NEW: Show modal loading state
        function showModalLoading(modalLoadingElement) {
            if (modalLoadingElement) {
                modalLoadingElement.classList.add('active');
            }
        }

        // NEW: Hide modal loading state
        function hideModalLoading(modalLoadingElement) {
            if (modalLoadingElement) {
                modalLoadingElement.classList.remove('active');
            }
        }

        // Setup real-time listeners
        function setupRealtimeListeners() {
            // Listen for changes in groups
            db.ref('groups').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    groups = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                } else {
                    groups = [];
                }
                
                isLoadingGroups = false;
                
                // Update UI
                displayGroups();
                loadExploreGroups();
            });
            
            // Listen for changes in userGroups
            db.ref('userGroups').on('value', (snapshot) => {
                if (snapshot.exists() && currentUser) {
                    const data = snapshot.val();
                    userGroups = Object.keys(data)
                        .filter(key => data[key].userId === currentUser.uid)
                        .map(key => ({
                            id: key,
                            ...data[key]
                        }));
                } else {
                    userGroups = [];
                }
                
                isLoadingUserGroups = false;
                isLoadingProfile = false;
                
                // Update UI
                loadMyGroups();
                loadProfilePage();
            });

            // NEW: Real-time notifications listener
            db.ref('notifications').on('value', (snapshot) => {
                if (snapshot.exists() && currentUser) {
                    const data = snapshot.val();
                    notifications = Object.keys(data)
                        .filter(key => data[key].userId === currentUser.uid)
                        .map(key => ({
                            id: key,
                            ...data[key]
                        }));
                    
                    notifications.sort((a, b) => b.createdAt - a.createdAt);
                } else {
                    notifications = [];
                }
                
                isLoadingNotifications = false;
                updateNotificationBadge();
                
                // Update notifications page if active
                if (document.getElementById('notificationsPage').classList.contains('active')) {
                    loadNotificationsPage();
                }
            });
        }

        // Load user data
        function loadUserData() {
            loadUserGroups();
            loadNotifications();
            loadReportedGroups();
            updateNotificationBadge();
        }

        // Load app data
        function loadAppData() {
            loadGroups();
            displayGroups();
            loadExploreGroups();
            loadProfilePage();
            hideSkeletonLoaders();
        }

        // Load groups from Firebase
        function loadGroups() {
            showLoading();
            isLoadingGroups = true;
            
            db.ref('groups').once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        groups = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                    } else {
                        groups = [];
                    }
                    isLoadingGroups = false;
                    hideLoading();
                })
                .catch(error => {
                    console.error("Error loading groups:", error);
                    showAlert('Error loading groups', 'error', 'fas fa-exclamation-circle');
                    isLoadingGroups = false;
                    hideLoading();
                });
        }

        // Load user groups from Firebase
        function loadUserGroups() {
            if (!currentUser) {
                userGroups = [];
                isLoadingUserGroups = false;
                return;
            }
            
            isLoadingUserGroups = true;
            
            db.ref('userGroups').orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        userGroups = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                    } else {
                        userGroups = [];
                    }
                    isLoadingUserGroups = false;
                })
                .catch(error => {
                    console.error("Error loading user groups:", error);
                    userGroups = [];
                    isLoadingUserGroups = false;
                });
        }

        // Load notifications from Firebase
        function loadNotifications() {
            if (!currentUser) {
                notifications = [];
                isLoadingNotifications = false;
                return;
            }
            
            isLoadingNotifications = true;
            
            db.ref('notifications').orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        notifications = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                        
                        notifications.sort((a, b) => b.createdAt - a.createdAt);
                    } else {
                        notifications = [];
                    }
                    isLoadingNotifications = false;
                    updateNotificationBadge();
                })
                .catch(error => {
                    console.error("Error loading notifications:", error);
                    isLoadingNotifications = false;
                });
        }

        // Load reported groups
        function loadReportedGroups() {
            if (!currentUser) {
                reportedGroups = [];
                return;
            }
            
            db.ref('reports').orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        reportedGroups = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                    } else {
                        reportedGroups = [];
                    }
                })
                .catch(error => {
                    console.error("Error loading reported groups:", error);
                });
        }

        // Update notification badge
        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            
            if (unreadCount > 0) {
                notificationBadge.textContent = unreadCount;
                notificationBadge.style.display = 'flex';
            } else {
                notificationBadge.style.display = 'none';
            }
        }

        // Display groups in horizontal layout
        function displayGroups() {
            featuredGroups.innerHTML = '';
            popularGroups.innerHTML = '';

            const approvedGroups = groups.filter(group => group.status === 'approved');

            if (approvedGroups.length === 0) {
                featuredGroups.innerHTML = `
                    <div class="skeleton-group-card">
                        <div class="skeleton-group-image skeleton"></div>
                        <div class="skeleton-group-content">
                            <div class="skeleton-category skeleton"></div>
                            <div class="skeleton-title skeleton"></div>
                            <div class="skeleton-description skeleton"></div>
                            <div class="skeleton-footer">
                                <div class="skeleton-poster">
                                    <div class="skeleton-avatar skeleton"></div>
                                    <div class="skeleton-name skeleton"></div>
                                </div>
                                <div class="skeleton-button skeleton"></div>
                            </div>
                        </div>
                    </div>
                    <div class="skeleton-group-card">
                        <div class="skeleton-group-image skeleton"></div>
                        <div class="skeleton-group-content">
                            <div class="skeleton-category skeleton"></div>
                            <div class="skeleton-title skeleton"></div>
                            <div class="skeleton-description skeleton"></div>
                            <div class="skeleton-footer">
                                <div class="skeleton-poster">
                                    <div class="skeleton-avatar skeleton"></div>
                                    <div class="skeleton-name skeleton"></div>
                                </div>
                                <div class="skeleton-button skeleton"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                popularGroups.innerHTML = `
                    <div class="skeleton-group-card">
                        <div class="skeleton-group-image skeleton"></div>
                        <div class="skeleton-group-content">
                            <div class="skeleton-category skeleton"></div>
                            <div class="skeleton-title skeleton"></div>
                            <div class="skeleton-description skeleton"></div>
                            <div class="skeleton-footer">
                                <div class="skeleton-poster">
                                    <div class="skeleton-avatar skeleton"></div>
                                    <div class="skeleton-name skeleton"></div>
                                </div>
                                <div class="skeleton-button skeleton"></div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            const featured = approvedGroups.filter(group => group.featured);
            const popular = approvedGroups.filter(group => !group.featured);

            popular.sort((a, b) => b.members - a.members);

            if (featured.length > 0) {
                featured.forEach(group => {
                    const groupCard = createGroupCard(group);
                    featuredGroups.appendChild(groupCard);
                });
            } else {
                 featuredGroups.innerHTML = `<div class="empty-state" style="width: 100%;"><p>No featured groups yet.</p></div>`;
            }

            if (popular.length > 0) {
                popular.forEach(group => {
                    const groupCard = createGroupCard(group);
                    popularGroups.appendChild(groupCard);
                });
            } else {
                popularGroups.innerHTML = `<div class="empty-state" style="width: 100%;"><p>No popular groups yet.</p></div>`;
            }
        }

        // Load explore groups - UPDATED with search functionality
        function loadExploreGroups() {
            exploreGroups.innerHTML = '';
            
            let filteredGroups = groups.filter(group => group.status === 'approved');
            
            // Apply category filter
            if (selectedCategory && selectedCategory !== 'all') {
                filteredGroups = filteredGroups.filter(group => group.category === selectedCategory);
            }
            
            // Apply search filter if search term exists
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (searchTerm) {
                filteredGroups = filteredGroups.filter(group => {
                    return group.name.toLowerCase().includes(searchTerm) || 
                           group.description.toLowerCase().includes(searchTerm) ||
                           group.category.toLowerCase().includes(searchTerm);
                });
            }
            
            switch (selectedSort) {
                case 'new':
                    filteredGroups.sort((a, b) => b.createdAt - a.createdAt);
                    break;
                case 'large':
                    filteredGroups.sort((a, b) => b.members - a.members);
                    break;
                case 'verified':
                    filteredGroups = filteredGroups.filter(group => group.poster.verified);
                    break;
                case 'popular':
                default:
                    filteredGroups.sort((a, b) => b.members - a.members);
                    break;
            }
            
            if (filteredGroups.length === 0) {
                exploreGroups.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>No groups found</p>
                        ${searchTerm ? `<p style="margin-top: 0.5rem; font-size: 0.9rem;">Try a different search term or category</p>` : ''}
                    </div>
                `;
                return;
            }
            
            filteredGroups.forEach(group => {
                const groupCard = createExploreGroupCard(group);
                exploreGroups.appendChild(groupCard);
            });
        }

        // Load my groups
        function loadMyGroups() {
            myGroupsList.innerHTML = '';
            
            if (!currentUser) {
                myGroupsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>Sign in to view your groups</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="showModal(signInModal)">
                            Sign In
                        </button>
                    </div>
                `;
                return;
            }
            
            let filteredGroups = userGroups;
            const activeTab = document.querySelector('.group-tab.active').getAttribute('data-tab');
            
            if (activeTab !== 'all') {
                filteredGroups = userGroups.filter(group => group.status === activeTab);
            }
            
            if (filteredGroups.length === 0) {
                myGroupsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>No ${activeTab} groups</p>
                    </div>
                `;
                return;
            }
            
            filteredGroups.forEach(group => {
                const groupCard = createMyGroupCard(group);
                myGroupsList.appendChild(groupCard);
            });
        }

        // Generate random color for avatar
        function getRandomColor() {
            const colors = [
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
                '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Get user avatar initials
        function getAvatarInitials(name) {
            if (!name) return 'U';
            const names = name.split(' ');
            if (names.length === 1) return names[0].charAt(0).toUpperCase();
            return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
        }

        // Create horizontal group card
        function createGroupCard(group) {
            const card = document.createElement('div');
            card.className = 'group-card-horizontal';
            const avatarColor = getRandomColor();
            const isReported = reportedGroups.some(r => r.groupId === group.id);
            
            card.innerHTML = `
                <div class="group-image">
                    ${group.image ? 
                        `<img src="${group.image}" alt="${group.name}">` :
                        `<i class="fas fa-users"></i>`
                    }
                    <div class="group-image-overlay">
                        <div class="group-members">
                            <i class="fas fa-users"></i> ${group.members}
                        </div>
                        ${group.featured ? 
                            `<div class="group-featured">
                                <i class="fas fa-star"></i> Featured
                            </div>` : ''
                        }
                    </div>
                </div>
                <div class="group-content">
                    <span class="group-category">${group.category}</span>
                    <h3 class="group-title">${group.name}</h3>
                    <p class="group-description">${group.description}</p>
                    <div class="group-footer">
                        <div class="group-poster">
                            <div class="poster-avatar" id="poster-avatar-${group.id}" style="background: ${avatarColor};">
                                ${getAvatarInitials(group.poster.name)}
                            </div>
                            <span class="poster-name" id="poster-${group.id}">
                                ${group.poster.name}
                                ${group.poster.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                            </span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            ${isReported ? 
                                `<button class="btn btn-warning btn-sm" disabled>
                                    <i class="fas fa-flag"></i> Reported
                                </button>` :
                                `<button class="btn btn-secondary btn-sm" onclick="reportGroup('${group.id}')">
                                    <i class="fas fa-flag"></i>
                                </button>`
                            }
                            <a href="${group.link}" target="_blank" class="btn btn-primary">
                                Join
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            loadPosterUserData(group.poster.userId, group.id, card);
            
            return card;
        }

        // Create explore group card
        function createExploreGroupCard(group) {
            const card = document.createElement('div');
            card.className = 'group-card-horizontal';
            const avatarColor = getRandomColor();
            const isReported = reportedGroups.some(r => r.groupId === group.id);
            
            card.innerHTML = `
                <div class="group-image">
                    ${group.image ? 
                        `<img src="${group.image}" alt="${group.name}">` :
                        `<i class="fas fa-users"></i>`
                    }
                    <div class="group-image-overlay">
                        <div class="group-members">
                            <i class="fas fa-users"></i> ${group.members}
                        </div>
                        ${group.featured ? 
                            `<div class="group-featured">
                                <i class="fas fa-star"></i> Featured
                            </div>` : ''
                        }
                    </div>
                </div>
                <div class="group-content">
                    <span class="group-category">${group.category}</span>
                    <h3 class="group-title">${group.name}</h3>
                    <p class="group-description">${group.description}</p>
                    <div class="group-footer">
                        <div class="group-poster">
                            <div class="poster-avatar" id="poster-avatar-${group.id}" style="background: ${avatarColor};">
                                ${getAvatarInitials(group.poster.name)}
                            </div>
                            <span class="poster-name" id="poster-${group.id}">
                                ${group.poster.name}
                                ${group.poster.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                            </span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            ${isReported ? 
                                `<button class="btn btn-warning btn-sm" disabled>
                                    <i class="fas fa-flag"></i> Reported
                                </button>` :
                                `<button class="btn btn-secondary btn-sm" onclick="reportGroup('${group.id}')">
                                    <i class="fas fa-flag"></i>
                                </button>`
                            }
                            <a href="${group.link}" target="_blank" class="btn btn-primary">
                                Join
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            loadPosterUserData(group.poster.userId, group.id, card);
            
            return card;
        }

        // Load real-time poster user data
        function loadPosterUserData(userId, groupId, card) {
            if (!userId) return;
            
            db.ref('users/' + userId).on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    
                    userProfilesCache[userId] = userData;
                    
                    const posterNameElement = card.querySelector(`#poster-${groupId}`);
                    const posterAvatarElement = card.querySelector(`#poster-avatar-${groupId}`);
                    
                    if (posterNameElement) {
                        const verifiedBadge = userData.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : '';
                        posterNameElement.innerHTML = `${userData.displayName || 'User'} ${verifiedBadge}`;
                    }
                    
                    if (posterAvatarElement && userData.profileImage) {
                        posterAvatarElement.innerHTML = `<img src="${userData.profileImage}" alt="${userData.displayName}" style="width: 100%; height: 100%; object-fit: cover;">`;
                    } else if (posterAvatarElement) {
                        const initials = getAvatarInitials(userData.displayName || 'User');
                        posterAvatarElement.innerHTML = initials;
                    }
                }
            });
        }

        // Create my group card
        function createMyGroupCard(group) {
            const card = document.createElement('div');
            card.className = `my-group-card ${group.status}`;
            
            let statusClass = '';
            let statusText = '';
            
            switch(group.status) {
                case 'pending':
                    statusClass = 'status-pending';
                    statusText = 'Pending Review';
                    break;
                case 'approved':
                    statusClass = 'status-approved';
                    statusText = 'Approved';
                    break;
                case 'rejected':
                    statusClass = 'status-rejected';
                    statusText = 'Rejected';
                    break;
            }
            
            card.innerHTML = `
                <div class="${statusClass} group-status">${statusText}</div>
                <h3 style="margin-bottom: 0.5rem;">${group.name}</h3>
                <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 0.5rem;">${group.description}</p>
                <div style="color: #888; font-size: 0.8rem; margin-bottom: 0.5rem;">
                    <i class="fas fa-users"></i> ${group.members} members  ${group.category}
                </div>
                ${group.rejectionReason ? 
                    `<div style="color: var(--error); font-size: 0.8rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-exclamation-circle"></i> ${group.rejectionReason}
                    </div>` : ''
                }
                <div class="group-actions">
                    <button class="btn btn-secondary" onclick="viewGroup('${group.id}')">
                        View
                    </button>
                    ${group.status === 'rejected' ? 
                        `<button class="btn btn-primary" onclick="resubmitGroup('${group.id}')">
                            Resubmit
                        </button>` : ''
                    }
                </div>
            `;
            return card;
        }

        // Load profile page
        function loadProfilePage() {
            if (!currentUser) {
                profileHeader.innerHTML = `
                    <div class="guest-welcome">
                        <div class="guest-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <h2>Welcome to ConnectNexus
                    </h2>
                        <p style="color: #aaa; margin: 1rem 0;">Create an account to manage your groups and profile</p>
                        <div class="guest-buttons">
                            <button class="btn btn-primary" onclick="showModal(signUpModal)">
                                Create Account
                            </button>
                            <button class="btn btn-secondary" onclick="showModal(signInModal)">
                                Sign In
                            </button>
                        </div>
                    </div>
                `;
                profileStats.style.display = 'none';
                profileActions.innerHTML = `
                    <div class="action-item" onclick="showModal(signUpModal)">
                        <div class="action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">Create Account</div>
                            <div style="color: #aaa; font-size: 0.8rem;">Join ConnectNexus community</div>
                        </div>
                    </div>
                    <div class="action-item" onclick="showModal(signInModal)">
                        <div class="action-icon">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">Sign In</div>
                            <div style="color: #aaa; font-size: 0.8rem;">Access your existing account</div>
                        </div>
                    </div>
                `;
            } else {
                const avatarColor = getRandomColor();
                const avatarInitials = getAvatarInitials(currentUser.displayName || currentUser.email);
                const verifiedBadge = currentUser.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : '';
                
                profileHeader.innerHTML = `
                    <div class="profile-avatar-container">
                        <div class="profile-avatar" id="profileAvatarDisplay">
                            ${currentUser.profileImage ? 
                                `<img src="${currentUser.profileImage}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` :
                                avatarInitials
                            }
                        </div>
                        <div class="profile-edit-btn" onclick="openEditProfileModal_NEW()">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <h2 class="profile-name">
                        ${currentUser.displayName || 'User'}
                        ${verifiedBadge}
                    </h2>
                    <p class="profile-email">${currentUser.email}</p>
                `;
                
                profileStats.style.display = 'grid';
                
                const totalGroups = userGroups.length;
                const approvedGroups = userGroups.filter(g => g.status === 'approved').length;
                const pendingGroups = userGroups.filter(g => g.status === 'pending').length;
                
                profileStats.innerHTML = `
                    <div class="stat-item">
                        <div class="stat-number">${totalGroups}</div>
                        <div class="stat-label">Groups Created</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${approvedGroups}</div>
                        <div class="stat-label">Approved</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${pendingGroups}</div>
                        <div class="stat-label">Pending</div>
                    </div>
                `;
                
                profileActions.innerHTML = `
                    <div class="action-item" onclick="openEditProfileModal_NEW()">
                        <div class="action-icon">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">Edit Profile</div>
                            <div style="color: #aaa; font-size: 0.8rem;">Update your personal information</div>
                        </div>
                    </div>
                    <div class="action-item" onclick="switchToPage('myGroupsPage')">
                        <div class="action-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">My Groups</div>
                            <div style="color: #aaa; font-size: 0.8rem;">Manage your created groups</div>
                        </div>
                    </div>
                    <div class="action-item" onclick="switchToPage('notificationsPage')">
                        <div class="action-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">Notifications</div>
                            <div style="color: #aaa; font-size: 0.8rem;">View your recent activities</div>
                        </div>
                    </div>
                    ${!currentUser.verified ? `
                    <div class="action-item" onclick="showModal(verificationModal)">
                        <div class="action-icon" style="background: rgba(0, 149, 246, 0.2);">
                            <i class="bi bi-patch-check-fill" style="color: #0095F6;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">Get Verified</div>
                            <div style="color: #aaa; font-size: 0.8rem;">Request verification badge</div>
                        </div>
                    </div>
                    ` : ''}
                    <div class="action-item" style="color: var(--error);" onclick="handleLogout()">
                        <div class="action-icon" style="background: rgba(244, 67, 54, 0.2); color: var(--error);">
                            <i class="fas fa-sign-out-alt"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">Logout</div>
                            <div style="color: #aaa; font-size: 0.8rem;">Sign out of your account</div>
                        </div>
                    </div>
                `;
            }
        }

        // Load notifications
        function loadNotificationsPage() {
            notificationsList.innerHTML = '';
            
            if (!currentUser) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <p>Sign in to view your notifications</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="showModal(signInModal)">
                            Sign In
                        </button>
                    </div>
                `;
                return;
            }
            
            if (notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <p>No notifications yet</p>
                    </div>
                `;
                return;
            }
            
            notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = 'notification-item';
                if (!notification.read) {
                    notificationItem.style.background = 'rgba(108, 99, 255, 0.1)';
                }
                notificationItem.innerHTML = `
                    <div class="notification-icon ${notification.type}">
                        <i class="${notification.icon}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${formatTime(notification.createdAt)}</div>
                    </div>
                `;
                notificationsList.appendChild(notificationItem);
            });
            
            markNotificationsAsRead();
        }

        // Format timestamp to readable time
        function formatTime(timestamp) {
            if (!timestamp) return 'Unknown time';
            
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) {
                return 'Just now';
            }
            
            if (diff < 3600000) {
                const minutes = Math.floor(diff / 60000);
                return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            }
            
            if (diff < 86400000) {
                const hours = Math.floor(diff / 3600000);
                return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            }
            
            if (diff < 604800000) {
                const days = Math.floor(diff / 86400000);
                return `${days} day${days > 1 ? 's' : ''} ago`;
            }
            
            return date.toLocaleDateString();
        }

        // Switch between pages
        function switchToPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === pageId) {
                    item.classList.add('active');
                }
            });
            
            if (pageId === 'profilePage') {
                loadProfilePage();
            } else if (pageId === 'notificationsPage') {
                loadNotificationsPage();
            } else if (pageId === 'myGroupsPage') {
                loadMyGroups();
            } else if (pageId === 'explorePage') {
                loadExploreGroups();
            }
            
            const headerSearch = document.getElementById('headerSearch');
            if (pageId === 'homePage' || pageId === 'explorePage') {
                headerSearch.style.display = 'block';
            } else {
                headerSearch.style.display = 'none';
            }
        }

        // Mark notifications as read
        function markNotificationsAsRead() {
            if (!currentUser || notifications.length === 0) return;
            
            const updates = {};
            notifications.forEach(notification => {
                if (!notification.read) {
                    updates[`/notifications/${notification.id}/read`] = true;
                }
            });
            
            if (Object.keys(updates).length > 0) {
                db.ref().update(updates)
                    .then(() => {
                        notifications.forEach(notification => {
                            notification.read = true;
                        });
                        updateNotificationBadge();
                    })
                    .catch(error => {
                        console.error("Error marking notifications as read:", error);
                    });
            }
        }

        // View group details
        function viewGroup(groupId) {
            const group = userGroups.find(g => g.id === groupId);
            if (!group) return;

            document.getElementById('groupViewTitle').textContent = group.name;
            
            let statusClass = '';
            let statusText = '';
            
            switch(group.status) {
                case 'pending':
                    statusClass = 'status-pending';
                    statusText = 'Pending Review';
                    break;
                case 'approved':
                    statusClass = 'status-approved';
                    statusText = 'Approved';
                    break;
                case 'rejected':
                    statusClass = 'status-rejected';
                    statusText = 'Rejected';
                    break;
            }

            document.getElementById('groupViewContent').innerHTML = `
                <div class="${statusClass} group-status">${statusText}</div>
                <div style="margin-bottom: 1rem;">
                    <strong>Description:</strong>
                    <p style="color: #aaa; margin-top: 0.5rem;">${group.description}</p>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Category:</strong>
                    <p style="color: #aaa; margin-top: 0.5rem;">${group.category}</p>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Members:</strong>
                    <p style="color: #aaa; margin-top: 0.5rem;">${group.members} members</p>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Group Link:</strong>
                    <p style="color: #aaa; margin-top: 0.5rem;">${group.link}</p>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>Submitted:</strong>
                    <p style="color: #aaa; margin-top: 0.5rem;">${formatTime(group.createdAt)}</p>
                </div>
                ${group.rejectionReason ? `
                <div style="margin-bottom: 1rem;">
                    <strong>Rejection Reason:</strong>
                    <p style="color: var(--error); margin-top: 0.5rem;">${group.rejectionReason}</p>
                </div>
                ` : ''}
            `;

            let actionsHTML = '';
            if (group.status === 'rejected') {
                actionsHTML = `
                    <button class="btn btn-primary" onclick="resubmitGroup('${group.id}')">
                        Resubmit
                    </button>
                    <button class="btn btn-secondary" onclick="closeAllModals()">
                        Close
                    </button>
                `;
            } else {
                actionsHTML = `
                    <button class="btn btn-warning" onclick="editGroup('${group.id}')">
                        Edit
                    </button>
                    <button class="btn btn-error" onclick="deleteGroup('${group.id}')">
                        Delete
                    </button>
                `;
            }

            document.getElementById('groupViewActions').innerHTML = actionsHTML;
            showModal(groupViewModal);
        }

        // Report group
        function reportGroup(groupId) {
            if (!currentUser) {
                showModal(signInModal);
                showAlert('Please sign in to report a group', 'warning', 'fas fa-exclamation-triangle');
                return;
            }
            
            reportForm.setAttribute('data-group-id', groupId);
            showModal(reportModal);
        }

        // Resubmit group
        function resubmitGroup(groupId) {
            const group = userGroups.find(g => g.id === groupId);
            if (group) {
                showLoading();
                
                db.ref('userGroups/' + groupId).update({
                    status: 'pending',
                    rejectionReason: '',
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                })
                .then(() => {
                    group.status = 'pending';
                    group.rejectionReason = '';
                    
                    showAlert('Group resubmitted for approval!', 'success', 'fas fa-check-circle');
                    closeAllModals();
                    loadMyGroups();
                    hideLoading();
                })
                .catch(error => {
                    console.error("Error resubmitting group:", error);
                    showAlert('Error resubmitting group', 'error', 'fas fa-exclamation-circle');
                    hideLoading();
                });
            }
        }

        // Edit group
        function editGroup(groupId) {
            showAlert('Edit feature coming soon!', 'info', 'fas fa-info-circle');
        }

        // Delete group
        function deleteGroup(groupId) {
            if (confirm('Are you sure you want to delete this group? This action cannot be undone.')) {
                showLoading();
                
                const group = userGroups.find(g => g.id === groupId);
                const isApproved = group && group.status === 'approved';
                
                db.ref('userGroups/' + groupId).remove()
                    .then(() => {
                        if (isApproved) {
                            return db.ref('groups').orderByChild('link').equalTo(group.link).once('value')
                                .then(snapshot => {
                                    if (snapshot.exists()) {
                                        const data = snapshot.val();
                                        const mainGroupId = Object.keys(data).find(key => 
                                            data[key].name === group.name && 
                                            data[key].description === group.description
                                        );
                                        
                                        if (mainGroupId) {
                                            return db.ref('groups/' + mainGroupId).remove();
                                        }
                                    }
                                    return Promise.resolve();
                                });
                        } else {
                            return Promise.resolve();
                        }
                    })
                    .then(() => {
                        userGroups = userGroups.filter(g => g.id !== groupId);
                        
                        showAlert('Group deleted successfully!', 'success', 'fas fa-check-circle');
                        closeAllModals();
                        loadMyGroups();
                        hideLoading();
                    })
                    .catch(error => {
                        console.error("Error deleting group:", error);
                        showAlert('Error deleting group', 'error', 'fas fa-exclamation-circle');
                        hideLoading();
                    });
            }
        }

        // Profile system functions
        function setupProfileEventListeners() {
            profileImageUploadArea.addEventListener('click', () => profileImageInput.click());
            profileImageInput.addEventListener('change', (e) => handleImageSelect(e, 'profile'));
            editProfileForm.addEventListener('submit', handleProfileUpdate_NEW);
        }

        function openEditProfileModal_NEW() {
            if (!currentUser) return;
            document.getElementById('editProfileName').value = currentUser.displayName || '';
            document.getElementById('editProfileEmail').value = currentUser.email || '';
            document.getElementById('editProfileBio').value = currentUser.bio || '';
            profileImageBase64 = null;
            if (currentUser.profileImage) {
                profileImagePreview.src = currentUser.profileImage;
                profileImagePreview.style.display = 'block';
                profileImageUploadArea.style.display = 'none';
            } else {
                profileImagePreview.style.display = 'none';
                profileImageUploadArea.style.display = 'block';
            }
            showModal(editProfileModal);
        }

        // UPDATED: Handle profile update with loading state
        function handleProfileUpdate_NEW(e) {
            e.preventDefault();
            if (!currentUser) return;
            
            // Show modal loading
            showModalLoading(editProfileModalLoading);
            
            const updates = {
                displayName: document.getElementById('editProfileName').value,
                email: document.getElementById('editProfileEmail').value,
                bio: document.getElementById('editProfileBio').value,
            };
            if (profileImageBase64) { 
                updates.profileImage = profileImageBase64; 
            }
            const user = auth.currentUser;
            db.ref('users/' + user.uid).update(updates).then(() => {
                const promises = [];
                if (updates.displayName !== user.displayName) { 
                    promises.push(user.updateProfile({ displayName: updates.displayName })); 
                }
                if (updates.email !== user.email) { 
                    promises.push(user.updateEmail(updates.email)); 
                }
                return Promise.all(promises);
            }).then(() => {
                // Hide modal loading with smooth transition
                setTimeout(() => {
                    hideModalLoading(editProfileModalLoading);
                    showAlert('Profile updated successfully!', 'success', 'fas fa-check-circle');
                    closeAllModals();
                    return db.ref('users/' + user.uid).once('value');
                }, 500);
            }).then(snapshot => {
                currentUser = { ...currentUser, ...snapshot.val() };
                loadProfilePage();
            }).catch(error => {
                hideModalLoading(editProfileModalLoading);
                showAlert(getErrorMessage(error.code), 'error', 'fas fa-exclamation-circle');
            });
        }

        // Handle image selection
        function handleImageSelect(e, imageType) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showAlert('Please select an image file', 'error', 'fas fa-exclamation-circle');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showAlert('Image size should be less than 5MB', 'error', 'fas fa-exclamation-circle');
                return;
            }
            
            currentImageType = imageType;
            currentImageInput = e.target;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                cropImage.src = e.target.result;
                
                if (imageType === 'group') {
                    addGroupModal.style.display = 'none';
                } else {
                    editProfileModal.style.display = 'none';
                }
                
                showModal(imageCropModal);
                
                setTimeout(() => {
                    if (cropper) {
                        cropper.destroy();
                    }
                    
                    const aspectRatio = imageType === 'profile' ? 1 : 16 / 9;
                    
                    cropper = new Cropper(cropImage, {
                        aspectRatio: aspectRatio,
                        viewMode: 1,
                        dragMode: 'move',
                        autoCropArea: 0.8,
                        restore: false,
                        guides: true,
                        center: true,
                        highlight: true,
                        cropBoxMovable: true,
                        cropBoxResizable: true,
                        toggleDragModeOnDblclick: true
                    });
                }, 100);
            };
            reader.readAsDataURL(file);
        }

        // Confirm crop
        function confirmCrop() {
            if (cropper) {
                const canvas = cropper.getCroppedCanvas({
                    maxWidth: 800,
                    maxHeight: 600,
                    fillColor: '#fff'
                });
                
                if (canvas) {
                    const croppedImageBase64 = canvas.toDataURL('image/jpeg', 0.8);
                    
                    if (currentImageType === 'group') {
                        groupImageBase64 = croppedImageBase64;
                        groupImagePreview.innerHTML = `<img src="${croppedImageBase64}" alt="Group Image" class="image-preview">`;
                        groupImagePreview.style.display = 'block';
                        imageCropModal.style.display = 'none';
                        addGroupModal.style.display = 'block';
                    } else if (currentImageType === 'profile') {
                        profileImageBase64 = croppedImageBase64;
                        profileImagePreview.src = croppedImageBase64;
                        profileImagePreview.style.display = 'block';
                        profileImageUploadArea.style.display = 'none';
                        imageCropModal.style.display = 'none';
                        editProfileModal.style.display = 'block';
                    }
                }
                
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
            }
        }

        // Close crop modal
        function closeCropModal() {
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
            imageCropModal.style.display = 'none';
            
            if (currentImageType === 'group') {
                addGroupModal.style.display = 'block';
            } else if (currentImageType === 'profile') {
                editProfileModal.style.display = 'block';
            }
            
            if (currentImageInput) {
                currentImageInput.value = '';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            addGroupBtn.addEventListener('click', handleAddGroupClick);

            notificationsBtn.addEventListener('click', () => switchToPage('notificationsPage'));

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = item.getAttribute('data-page');
                    switchToPage(pageId);
                });
            });

            document.getElementById('homeLogo').addEventListener('click', (e) => {
                e.preventDefault();
                switchToPage('homePage');
            });

            groupTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    groupTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    loadMyGroups();
                });
            });
            
            // UPDATED: Explore page category chips
            categoryChips.forEach(chip => {
                chip.addEventListener('click', () => {
                    // Remove active class from all chips
                    categoryChips.forEach(c => c.classList.remove('active'));
                    // Add active class to clicked chip
                    chip.classList.add('active');
                    // Update selected category
                    selectedCategory = chip.getAttribute('data-filter');
                    // Reload explore groups
                    loadExploreGroups();
                });
            });

            closeModals.forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });

            // UPDATED: Form submissions with loading states
            groupForm.addEventListener('submit', handleGroupSubmit);
            signInForm.addEventListener('submit', handleSignIn);
            signUpForm.addEventListener('submit', handleSignUp);
            verificationForm.addEventListener('submit', handleVerificationRequest);
            reportForm.addEventListener('submit', handleReportSubmit);
            
            showSignUpLink.addEventListener('click', (e) => {
                e.preventDefault();
                closeAllModals();
                showModal(signUpModal);
            });
            
            showSignInLink.addEventListener('click', (e) => {
                e.preventDefault();
                closeAllModals();
                showModal(signInModal);
            });

            // UPDATED: Search functionality for both home and explore pages
            searchInput.addEventListener('input', function() {
                const currentPage = document.querySelector('.page.active').id;
                if (currentPage === 'homePage' || currentPage === 'explorePage') {
                    if (currentPage === 'explorePage') {
                        loadExploreGroups();
                    } else {
                        filterGroups();
                    }
                }
            });

            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    closeAllModals();
                }
            });
            
            groupImageUploadArea.addEventListener('click', () => {
                groupImageInput.click();
            });
            
            groupImageInput.addEventListener('change', (e) => {
                handleImageSelect(e, 'group');
            });
            
            cropZoomInBtn.addEventListener('click', () => {
                if (cropper) {
                    cropper.zoom(0.1);
                }
            });
            
            cropZoomOutBtn.addEventListener('click', () => {
                if (cropper) {
                    cropper.zoom(-0.1);
                }
            });
            
            cropResetBtn.addEventListener('click', () => {
                if (cropper) {
                    cropper.reset();
                }
            });
            
            cropRotateBtn.addEventListener('click', () => {
                if (cropper) {
                    cropper.rotate(90);
                }
            });
            
            confirmCropBtn.addEventListener('click', confirmCrop);
            cancelCropBtn.addEventListener('click', closeCropModal);
            
            setupProfileEventListeners(); 
        }

        // Handle add group click
        function handleAddGroupClick() {
            if (!currentUser) {
                showModal(signInModal);
                showAlert('Please sign in or create an account to add groups', 'warning', 'fas fa-exclamation-triangle');
            } else {
                groupForm.reset();
                groupImagePreview.innerHTML = '';
                groupImagePreview.style.display = 'none';
                groupImageBase64 = null;
                showModal(addGroupModal);
            }
        }

        // Show modal
        function showModal(modal) {
            modal.style.display = 'block';
        }

        // Close all modals
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            
            if (imageCropModal.style.display === 'block') {
                closeCropModal();
            }
        }

        // UPDATED: Handle sign in with loading state
        function handleSignIn(e) {
            e.preventDefault();
            
            const email = document.getElementById('signInEmail').value;
            const password = document.getElementById('signInPassword').value;
            
            // Show modal loading
            showModalLoading(signInModalLoading);
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    // Hide modal loading with smooth transition
                    setTimeout(() => {
                        hideModalLoading(signInModalLoading);
                        showAlert('Signed in successfully!', 'success', 'fas fa-check-circle');
                        signInModal.style.display = 'none';
                        signInForm.reset();
                    }, 500);
                })
                .catch(error => {
                    hideModalLoading(signInModalLoading);
                    console.error("Sign in error:", error);
                    showAlert(getErrorMessage(error.code), 'error', 'fas fa-exclamation-circle');
                });
        }

        // UPDATED: Handle sign up with loading state
        function handleSignUp(e) {
            e.preventDefault();
            
            const name = document.getElementById('signUpName').value;
            const email = document.getElementById('signUpEmail').value;
            const password = document.getElementById('signUpPassword').value;
            
            // Show modal loading
            showModalLoading(signUpModalLoading);
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    return userCredential.user.updateProfile({
                        displayName: name
                    });
                })
                .then(() => {
                    const userData = {
                        displayName: name,
                        email: email,
                        verified: false,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    return db.ref('users/' + auth.currentUser.uid).set(userData);
                })
                .then(() => {
                    // Hide modal loading with smooth transition
                    setTimeout(() => {
                        hideModalLoading(signUpModalLoading);
                        showAlert('Account created successfully!', 'success', 'fas fa-check-circle');
                        signUpModal.style.display = 'none';
                        signUpForm.reset();
                    }, 500);
                })
                .catch(error => {
                    hideModalLoading(signUpModalLoading);
                    console.error("Sign up error:", error);
                    showAlert(getErrorMessage(error.code), 'error', 'fas fa-exclamation-circle');
                });
        }

        // UPDATED: Handle group submission with loading state
        function handleGroupSubmit(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('groupName').value,
                description: document.getElementById('groupDescription').value,
                category: document.getElementById('groupCategory').value,
                members: parseInt(document.getElementById('groupMembers').value),
                link: document.getElementById('groupLink').value,
                userId: currentUser.uid,
                userName: currentUser.displayName || 'User',
                userAvatar: getAvatarInitials(currentUser.displayName || currentUser.email),
                userVerified: currentUser.verified || false,
                status: 'pending',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            if (groupImageBase64) {
                formData.image = groupImageBase64;
            }
            
            // Show modal loading
            showModalLoading(addGroupModalLoading);
            
            saveGroupToDatabase(formData);
        }

        // UPDATED: Save group to database with loading state
        function saveGroupToDatabase(formData) {
            db.ref('userGroups').push(formData)
                .then(() => {
                    // Hide modal loading with smooth transition
                    setTimeout(() => {
                        hideModalLoading(addGroupModalLoading);
                        showAlert('Group submitted for approval!', 'success', 'fas fa-check-circle');
                        addGroupModal.style.display = 'none';
                        groupForm.reset();
                        groupImagePreview.innerHTML = '';
                        groupImagePreview.style.display = 'none';
                        groupImageBase64 = null;
                        loadUserGroups();
                    }, 500);
                })
                .catch(error => {
                    hideModalLoading(addGroupModalLoading);
                    console.error("Error saving group:", error);
                    showAlert('Error submitting group', 'error', 'fas fa-exclamation-circle');
                });
        }

        // UPDATED: Handle verification request with loading state
        function handleVerificationRequest(e) {
            e.preventDefault();
            
            const reason = document.getElementById('verificationReason').value;
            
            // Show modal loading
            showModalLoading(verificationModalLoading);
            
            const verificationData = {
                userId: currentUser.uid,
                userName: currentUser.displayName || 'User',
                userEmail: currentUser.email,
                reason: reason,
                status: 'pending',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            db.ref('verificationRequests').push(verificationData)
                .then(() => {
                    // Hide modal loading with smooth transition
                    setTimeout(() => {
                        hideModalLoading(verificationModalLoading);
                        showAlert('Verification request submitted!', 'success', 'fas fa-check-circle');
                        verificationModal.style.display = 'none';
                        verificationForm.reset();
                    }, 500);
                })
                .catch(error => {
                    hideModalLoading(verificationModalLoading);
                    console.error("Error submitting verification request:", error);
                    showAlert('Error submitting verification request', 'error', 'fas fa-exclamation-circle');
                });
        }

        // UPDATED: Handle report submission with loading state
        function handleReportSubmit(e) {
            e.preventDefault();
            
            const groupId = reportForm.getAttribute('data-group-id');
            const reason = document.querySelector('input[name="reason"]:checked')?.value || '';
            const description = document.getElementById('reportDescription').value;
            
            if (!reason) {
                showAlert('Please select a reason for reporting', 'warning', 'fas fa-exclamation-triangle');
                return;
            }
            
            // Show modal loading
            showModalLoading(reportModalLoading);
            
            const group = groups.find(g => g.id === groupId);
            if (!group) {
                hideModalLoading(reportModalLoading);
                showAlert('Group not found', 'error', 'fas fa-exclamation-circle');
                return;
            }
            
            const reportData = {
                groupId: groupId,
                groupName: group.name,
                groupLink: group.link,
                userId: currentUser.uid,
                userName: currentUser.displayName || 'User',
                userEmail: currentUser.email,
                reason: reason,
                description: description,
                status: 'pending',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            db.ref('reports').push(reportData)
                .then(() => {
                    // Hide modal loading with smooth transition
                    setTimeout(() => {
                        hideModalLoading(reportModalLoading);
                        showAlert('Report submitted successfully!', 'success', 'fas fa-check-circle');
                        reportModal.style.display = 'none';
                        reportForm.reset();
                        
                        reportedGroups.push({
                            groupId: groupId,
                            reason: reason
                        });
                        
                        displayGroups();
                        loadExploreGroups();
                    }, 500);
                })
                .catch(error => {
                    hideModalLoading(reportModalLoading);
                    console.error("Error submitting report:", error);
                    showAlert('Error submitting report', 'error', 'fas fa-exclamation-circle');
                });
        }

        // Handle logout
        function handleLogout() {
            auth.signOut()
                .then(() => {
                    showAlert('Logged out successfully', 'info', 'fas fa-info-circle');
                    currentUser = null;
                    userGroups = [];
                    notifications = [];
                    reportedGroups = [];
                    loadProfilePage();
                    loadMyGroups();
                    updateNotificationBadge();
                })
                .catch(error => {
                    console.error("Logout error:", error);
                    showAlert('Error logging out', 'error', 'fas fa-exclamation-circle');
                });
        }

        // Filter groups by search term
        function filterGroups() {
            const searchTerm = searchInput.value.toLowerCase();
            showLoading();
            
            setTimeout(() => {
                let filteredGroups = groups;
                
                if (searchTerm) {
                    filteredGroups = groups.filter(group => {
                        return group.name.toLowerCase().includes(searchTerm) || 
                               group.description.toLowerCase().includes(searchTerm) ||
                               group.category.toLowerCase().includes(searchTerm);
                    });
                }
                
                const featured = filteredGroups.filter(group => group.featured && group.status === 'approved');
                const popular = filteredGroups.filter(group => !group.featured && group.status === 'approved');
                
                popular.sort((a, b) => b.members - a.members);
                
                featuredGroups.innerHTML = '';
                popularGroups.innerHTML = '';
                
                featured.forEach(group => {
                    const groupCard = createGroupCard(group);
                    featuredGroups.appendChild(groupCard);
                });
                
                popular.forEach(group => {
                    const groupCard = createGroupCard(group);
                    popularGroups.appendChild(groupCard);
                });
                
                hideLoading();
            }, 500);
        }

        // Show modern alert
        function showAlert(message, type, icon) {
            alert.innerHTML = `
                <i class="${icon} alert-icon"></i>
                <span>${message}</span>
            `;
            alert.className = `alert alert-${type} show`;
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 4000);
        }

        // Get user-friendly error message
        function getErrorMessage(errorCode) {
            switch (errorCode) {
                case 'auth/user-not-found':
                    return 'No account found with this email';
                case 'auth/wrong-password':
                    return 'Incorrect password';
                case 'auth/email-already-in-use':
                    return 'Email is already in use';
                case 'auth/weak-password':
                    return 'Password should be at least 6 characters';
                case 'auth/invalid-email':
                    return 'Invalid email address';
                case 'auth/user-disabled':
                    return 'This account has been disabled';
                case 'auth/too-many-requests':
                    return 'Too many failed attempts. Try again later';
                case 'auth/network-request-failed':
                    return 'Network error. Check your connection';
                default:
                    return 'An error occurred. Please try again';
            }
        }

        // Show splash screen
        function showSplashScreen() {
            splashScreen.style.display = 'flex';
        }

        // Hide splash screen
        function hideSplashScreen() {
            splashScreen.style.opacity = '0';
            setTimeout(() => {
                splashScreen.style.display = 'none';
                mainContent.classList.add('loaded');
            }, 500);
        }

        // Show loading spinner
        function showLoading() {
            loadingSpinner.classList.add('active');
        }

        // Hide loading spinner
        function hideLoading() {
            loadingSpinner.classList.remove('active');
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    <script type='text/javascript' src='//pl27861066.effectivegatecpm.com/b0/17/57/b01757820f15e07ddba8a408697745e0.js'></script>
</body>
</html>
